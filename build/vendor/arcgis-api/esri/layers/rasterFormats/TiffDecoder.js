//>>built
define("esri/layers/rasterFormats/TiffDecoder",[],function(){var D=function(){var a=new ArrayBuffer(4),c=new Uint8Array(a),a=new Uint32Array(a);c[0]=1;c[1]=2;c[2]=3;c[3]=4;return 67305985===a[0]},H=function(){var a=[];a[254]="NEWSUBFILETYPE";a[255]="SUBFILETYPE";a[256]="IMAGEWIDTH";a[257]="IMAGELENGTH";a[258]="BITSPERSAMPLE";a[259]="COMPRESSION";a[262]="PHOTOMETRICINTERPRETATION";a[263]="THRESHHOLDING";a[264]="CELLWIDTH";a[265]="CELLLENGTH";a[266]="FILLORDER";a[269]="DOCUMENTNAME";a[270]="IMAGEDESCRIPTION";
a[271]="MAKE";a[272]="MODEL";a[273]="STRIPOFFSETS";a[274]="ORIENTATION";a[277]="SAMPLESPERPIXEL";a[278]="ROWSPERSTRIP";a[279]="STRIPBYTECOUNTS";a[280]="MINSAMPLEVALUE";a[281]="MAXSAMPLEVALUE";a[282]="XRESOLUTION";a[283]="YRESOLUTION";a[284]="PLANARCONFIGURATION";a[285]="PAGENAME";a[286]="XPOSITION";a[287]="YPOSITION";a[288]="FREEOFFSETS";a[289]="FREEBYTECOUNTS";a[290]="GRAYRESPONSEUNIT";a[291]="GRAYRESPONSECURVE";a[292]="T4OPTIONS";a[293]="T6OPTIONS";a[296]="RESOLUTIONUNIT";a[297]="PAGENUMBER";a[300]=
"COLORRESPONSEUNIT";a[301]="TRANSFERFUNCTION";a[305]="SOFTWARE";a[306]="DATETIME";a[315]="ARTIST";a[316]="HOSTCOMPUTER";a[317]="PREDICTOR";a[318]="WHITEPOINT";a[319]="PRIMARYCHROMATICITIES";a[320]="COLORMAP";a[321]="HALFTONEHINTS";a[322]="TILEWIDTH";a[323]="TILELENGTH";a[324]="TILEOFFSETS";a[325]="TILEBYTECOUNTS";a[326]="BADFAXLINES";a[327]="CLEANFAXDATA";a[328]="CONSECUTIVEBADFAXLINES";a[330]="SUBIFD";a[332]="INKSET";a[333]="INKNAMES";a[334]="NUMBEROFINKS";a[336]="DOTRANGE";a[337]="TARGETPRINTER";
a[338]="EXTRASAMPLES";a[339]="SAMPLEFORMAT";a[340]="SMINSAMPLEVALUE";a[341]="SMAXSAMPLEVALUE";a[342]="TRANSFERRANGE";a[512]="JPEGPROC";a[513]="JPEGIFOFFSET";a[514]="JPEGIFBYTECOUNT";a[515]="JPEGRESTARTINTERVAL";a[517]="JPEGLOSSLESSPREDICTORS";a[518]="JPEGPOINTTRANSFORM";a[519]="JPEGQTABLES";a[520]="JPEGDCTABLES";a[521]="JPEGACTABLES";a[529]="YCBCRCOEFFICIENTS";a[530]="YCBCRSUBSAMPLING";a[531]="YCBCRPOSITIONING";a[532]="REFERENCEBLACKWHITE";a[33432]="COPYRIGHT";a[42112]="GDAL_METADATA";a[42113]="GDAL_NODATA";
a[50844]="RPCCOEFFICIENT";a[34735]="GEOKEYDIRECTORY";a[34736]="GEODOUBLEPARAMS";a[34737]="GEOASCIIPARAMS";return a}(),E=[0,1,1,2,4,8,1,1,2,4,8,4,8],F=function(a,c){var n="UNKNOWN";3===a?n="F32":1===a?8>=c?n="U8":16>=c?n="U16":32>=c&&(n="U32"):2===a&&(8>=c?n="S8":16>=c?n="S16":32>=c&&(n="S32"));return n};return{decode:function(a){var c,n=new DataView(a,0,8);c=n.getUint16(0,!1);if(18761===c)c=!0;else if(19789===c)c=!1;else throw"unexpected endianess byte";if(42!==n.getUint16(2,c))throw"unexpected tiff identifier";
for(var n=n.getUint32(4,c),z,y,A,h,w,x,d,g,b=[];n;){z=(new DataView(a,n,2)).getUint16(0,c);y=n+2;n=(new DataView(a,y+12*z,4)).getUint32(0,c);g={};for(A=0;A<z;A++)if(h=new DataView(a,y,12),w=h.getUint16(0,c),x=h.getUint16(2,c),d=h.getUint32(4,c),h=h.getUint32(8,c),y+=12,!(7===x||12<x)){h=d={fieldTag:w,fieldType:x,fieldValueCount:d,fieldValueOffset:h};var f=a,q=c,e=[],B=d.fieldType,v=d.fieldValueCount,u=d.fieldValueOffset,r=u,C=E[B],r=8*C,I=v*C,G=8*v*E[B],l=void 0,l=void 0;if(32>=G)if(q||(u>>>=32-G),
1===v)e=[u];else for(l=0;l<v;l++)e.push(u<<r*l>>>32-r);else for(r=u;r<u+I;r+=C){switch(B){case 1:l=(new DataView(f,r,1)).getUint8(0);break;case 2:l=(new DataView(f,r,1)).getUint8(0);break;case 3:l=(new DataView(f,r,2)).getUint16(0,q);break;case 4:l=(new DataView(f,r,4)).getUint32(0,q);break;case 5:l=(new DataView(f,r,4)).getUint32(0,q)/(new DataView(f,r+4,4)).getUint32(0,q);break;case 6:l=(new DataView(f,r,1)).getInt8(0);break;case 8:l=(new DataView(f,r,2)).getInt16(0,q);break;case 9:l=(new DataView(f,
r,4)).getInt32(0,q);break;case 10:l=(new DataView(f,r,4)).getInt32(0,q)/(new DataView(f,r+4,4)).getInt32(0,q);break;case 11:l=(new DataView(f,r,4)).getFloat32(0,q);break;case 12:l=(new DataView(f,r,8)).getFloat64(0,q);break;case 7:l=null;break;default:l=null}e.push(l)}if(2===B){f="";q=e;e=[];for(l=0;l<q.length;l++)0===q[l]?(e.push(f),f=""):f+=String.fromCharCode(q[l])}h.fieldValues=e;h=g;e=H[w];void 0===e&&(e="unknown"+w);h[e]={type:x,values:d.fieldValues}}b.push(g)}if(0===b.length)throw"no valid image file directory";
var k,b=b[0],n=void 0===b.GDAL_NODATA||null===b.GDAL_NODATA?null:parseFloat(b.GDAL_NODATA.values[0]);if(b.TILEOFFSETS){var s,p;k=D()===c;c=b.TILEOFFSETS?b.TILEOFFSETS.values:void 0;if(void 0===c)k=void 0;else{z=b.TILEBYTECOUNTS.values;y=b.TILEWIDTH.values[0];A=b.TILELENGTH.values[0];w=b.IMAGEWIDTH.values[0];x=b.IMAGELENGTH.values[0];var t=w*x;h=b.BITSPERSAMPLE.values[0];var m=b.SAMPLESPERPIXEL.values[0];d=b.SAMPLEFORMAT?b.SAMPLEFORMAT.values[0]:1;g=F(d,h);if(1!==(b.PLANARCONFIGURATION?b.PLANARCONFIGURATION.values[0]:
1))throw"can only handle PLANARCONFIGURATION\x3d1";if(3<d)k=void 0;else{3===d?(s=new Float32Array(t*m),p=Float32Array):1===d?8>=h?(s=new Uint8Array(t*m),p=Uint8Array):16>=h?(s=new Uint16Array(t*m),p=Uint16Array):32>=h&&(s=new Uint32Array(t*m),p=Uint32Array):2===d&&(8>=h?(s=new Int8Array(t*m),p=Int8Array):16>=h?(s=new Int16Array(t*m),p=Int16Array):32>=h&&(s=new Int32Array(t*m),p=Int32Array));d=Math.ceil(w/y);if(0===h%8)for(b=0;b<c.length;b++){f=Math.floor(b/d)*A;q=b%d*y;h=(f*w+q)*m;if("U8"===g||"S8"===
g||k)B=a.slice(c[b],c[b]+z[b]);else switch(B=new ArrayBuffer(z[b]),v=new Uint8Array(a,c[b],z[b]),u=new Uint8Array(B),g){case "U16":case "S16":for(e=0;e<v.length;e+=2)u[e]=v[e+1],u[e+1]=v[e];break;case "U32":case "S32":case "F32":for(e=0;e<v.length;e+=4)u[e]=v[e+3],u[e+1]=v[e+2],u[e+2]=v[e+1],u[e+3]=v[e]}e=new p(B);q=Math.min(y,w-q);C=Math.min(A,x-f);for(f=0;f<C;f++){v=h+f*w*m;u=f*y*m;for(B=0;B<q*m;B++,v++,u++)s[v]=e[u]}}c={width:w,height:x,pixelType:g};if(1===m)c.pixels=[s];else{c.pixels=[];for(b=
0;b<m;b++){k=new p(t);for(a=0;a<t;a++)k[a]=s[a*m+b];c.pixels.push(k)}}k=c}}}else if(b.STRIPOFFSETS)if(k=D()===c,c=b.STRIPOFFSETS?b.STRIPOFFSETS.values:void 0,void 0===c)k=void 0;else{z=b.STRIPBYTECOUNTS.values;y=b.ROWSPERSTRIP.values;A=b.IMAGEWIDTH.values[0];w=b.IMAGELENGTH.values[0];s=A*w;g=b.BITSPERSAMPLE.values[0];p=b.SAMPLESPERPIXEL.values[0];d=b.SAMPLEFORMAT?b.SAMPLEFORMAT.values[0]:1;x=F(d,g);if(1!==(b.PLANARCONFIGURATION?b.PLANARCONFIGURATION.values[0]:1))throw"can only handle PLANARCONFIGURATION\x3d1";
if(1!==(b.COMPRESSION?b.COMPRESSION.values[0]:1))throw"compressed tiff is not supported at this moment";if(3<d)k=void 0;else{3===d?(t=new Float32Array(s*p),m=Float32Array):1===d?8>=g?(t=new Uint8Array(s*p),m=Uint8Array):16>=g?(t=new Uint16Array(s*p),m=Uint16Array):32>=g&&(t=new Uint32Array(s*p),m=Uint32Array):2===d&&(8>=g?(t=new Int8Array(s*p),m=Int8Array):16>=g?(t=new Int16Array(s*p),m=Int16Array):32>=g&&(t=new Int32Array(A*w*p),m=Int32Array));if(0===g%8)for(g=0;g<c.length;g++){b=g*(y*A)*p;if("U8"===
x||"S8"===x||k)h=a.slice(c[g],c[g]+z[g]);else switch(h=new ArrayBuffer(z[g]),e=new Uint8Array(a,c[g],z[g]),f=new Uint8Array(h),x){case "U16":case "S16":for(d=0;d<e.length;d+=2)f[d]=e[d+1],f[d+1]=e[d];break;case "U32":case "S32":case "F32":for(d=0;d<e.length;d+=4)f[d]=e[d+3],f[d+1]=e[d+2],f[d+2]=e[d+1],f[d+3]=e[d]}d=new m(h);t.set(d,b)}c={width:A,height:w,pixelType:x};if(1===p)c.pixels=[t];else{c.pixels=[];for(g=0;g<p;g++){k=new m(s);for(a=0;a<s;a++)k[a]=t[a*p+g];c.pixels.push(k)}}k=c}}if(null!==n){k.maskData=
new Uint8Array(k.width*k.height);for(a=0;a<k.width*k.height;a++)k.maskData[a]=k.pixels[0][a]===n?0:1;k.noDataValue=n}return k}}});